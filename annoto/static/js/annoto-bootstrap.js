!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"object"==typeof exports?exports.Annoto=e():t.Annoto=e()}(window,function(){return function(t){function e(e){for(var n,r,i=e[0],s=e[1],a=0,u=[];a<i.length;a++)r=i[a],o[r]&&u.push(o[r][0]),o[r]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(c&&c(e);u.length;)u.shift()()}var n={},o={39:0};function r(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.e=function(t){var e=[],n=o[t];if(0!==n)if(n)e.push(n[2]);else{var i=new Promise(function(e,r){n=o[t]=[e,r]});e.push(n[2]=i);var s,a=document.getElementsByTagName("head")[0],c=document.createElement("script");c.charset="utf-8",c.timeout=120,r.nc&&c.setAttribute("nonce",r.nc),c.src=function(t){return r.p+""+({0:"vendors~app~app-bootstrap",1:"vendors~app-bootstrap",2:"app-bootstrap",3:"vendors~timeline",4:"vendors~player-adaptor-vimeo",5:"vendors~components",6:"stats",7:"timeline",8:"player-adaptor-wistia",9:"player-adaptor-h5p",10:"player-adaptor-flow",11:"player-adaptor-vimeo",12:"player-adaptor-kaltura",13:"player-adaptor-vjs",14:"player-adaptor-jw",15:"player-adaptor-jw6",16:"player-adaptor-yt",17:"player-adaptor-html5",18:"demo-discussions",19:"cta",20:"lang-cs",21:"lang-fr",22:"lang-hi",23:"lang-it",24:"lang-ja",25:"lang-ko",26:"lang-nl",27:"lang-no",28:"lang-pl",29:"lang-pt",30:"lang-ru",31:"lang-sv",32:"lang-tr",33:"lang-ua",34:"lang-zh",35:"lang-de",36:"lang-es",37:"lang-da",38:"components"}[t]||t)+"."+{0:"0e90b248f19874fdea64",1:"f116df674025a112baa2",2:"7fd6ba2a65c1d4e95b3f",3:"833d1a5029a5539e4d1b",4:"3a438882afa7377b9b11",5:"94bcce34280586e3d323",6:"d46c721a721bd88ef718",7:"bb3ac8e3cf95e1aa948f",8:"58095c533704db8ad10b",9:"2382fe33ea6c19e97923",10:"f35833bb37df6cd0ce34",11:"c431abf5155632893acf",12:"a01f08fcda59b8995bba",13:"41c43dbb3e8bb38281e5",14:"3b2928d99096e1de2364",15:"bd0c6eafddafc37e05d4",16:"7fb9fe86c52e4f79705d",17:"cc6985c48149baa85459",18:"b44e34933a54ff7ce718",19:"cff07b2e534aa50f23f9",20:"5625295358eeadf1bcb4",21:"6f383807e36af7720378",22:"8f96d415817fb56c6d06",23:"8f0a8fe021e338dee405",24:"2156c53a6470ffd97d71",25:"0847c44a358401cc577d",26:"55d7fe117151dc76f176",27:"4b56819e47108e623d33",28:"859495ba3543c04d53af",29:"e2cab4269565890418a1",30:"eacbe8ad962a304b37c4",31:"9ca26931ab3b03c4d4c2",32:"51af910e8e511c9e9548",33:"d3d7798d2e284873198f",34:"818f195e89609c763ca9",35:"5c468ee71e63ea2d7abf",36:"170f94db2aa5848f64d6",37:"33cc5e3386c3a5ae117c",38:"ff7513d47949032d9107"}[t]+".chunk.js"}(t),s=function(e){c.onerror=c.onload=null,clearTimeout(u);var n=o[t];if(0!==n){if(n){var r=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src,s=new Error("Loading chunk "+t+" failed.\n("+r+": "+i+")");s.type=r,s.request=i,n[1](s)}o[t]=void 0}};var u=setTimeout(function(){s({type:"timeout",target:c})},12e4);c.onerror=c.onload=s,a.appendChild(c)}return Promise.all(e)},r.m=t,r.c=n,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="https://app.annoto.net/",r.oe=function(t){throw console.error(t),t};var i=window.webpackJsonpAnnoto=window.webpackJsonpAnnoto||[],s=i.push.bind(i);i.push=e,i=i.slice();for(var a=0;a<i.length;a++)e(i[a]);var c=s;return r(r.s=56)}([,,,,,,,,,,,,function(t,e,n){"use strict";n.d(e,"a",function(){return o});var o={env:Object({ENV:{APP_URL:"https://app.annoto.net",API_URL:"https://api.annoto.net",AUTH_URL:"https://auth.annoto.net",DBA_URL:"https://dba.annoto.net",ASSETS_URL:"https://assets.annoto.net",KEEN:{PROJECT_ID:"591c72c70935ce40a59fb75c",KEY:"E61FBA80F9A744C68773A67794EEDEA7CC5E2C166C41434B9C1688B273A27C5920F4BE2CCCEB8A99E571E1B6A8E272356C0D1764CD4C40890BC891C2A935379BF768913922E288AE073A85B48DFD36FB53CB997C2E1E6FAE4D59505B388105FA",DEBUG:!1},AUTH:{GOOGLE_CLIENT_ID:"138093888688-k79miun4k1l0bfj6uv0p86i1tmsonajt.apps.googleusercontent.com",FACEBOOK_CLIENT_ID:"1421207401490615"}},envName:"production"}),appID:"annoto-app-root",appContainerID:"annoto-app",defaultAppContainerID:"annoto-app-default",dbaID:"annoto-dba-app",bluebirdUrl:"https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.5.0/bluebird.min.js",fetchUrl:"https://cdnjs.cloudflare.com/ajax/libs/fetch/1.1.1/fetch.min.js",robotoFontUrl:"https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium,400,400italic,500,500italic,600,600italic,700,700italic"}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},,,function(t,e,n){t.exports=n(31)},function(t,e){var n,o,r=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(t){n=i}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(t){o=s}}();var c,u=[],l=!1,p=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):p=-1,u.length&&f())}function f(){if(!l){var t=a(d);l=!0;for(var e=u.length;e;){for(c=u,u=[];++p<e;)c&&c[p].run();p=-1,e=u.length}c=null,l=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function g(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new h(t,e)),1!==u.length||l||a(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},,,,,,,,,,,function(t,e,n){var o=n(47),r=n(16);function i(t){var e="Event(s) not extended: "+t;this.emit("error",e)}t.exports={extendEvent:function(t,e){if(2!==arguments.length||"string"!=typeof t||"object"!=typeof e&&"function"!=typeof e)return void i.call(this,"Incorrect arguments provided to #extendEvent method");return this.extensions.collections[t]=this.extensions.collections[t]||[],this.extensions.collections[t].push(e),this.emit("extendEvent",t,e),this},extendEvents:function(t){if(1!==arguments.length||"object"!=typeof t&&"function"!=typeof t)return void i.call(this,"Incorrect arguments provided to #extendEvents method");return this.extensions.events.push(t),this.emit("extendEvents",t),this},getExtendedEventBody:function(t,e){e&&e.length>0&&r(e,function(e,n){var r="function"==typeof e?e():e;o(t,r)});return t}}},function(t,e,n){t.exports=n(30)},function(t,e){t.exports=function(t){for(var e=1;e<arguments.length;e++)for(var n in arguments[e])t[n]=arguments[e][n];return t}},function(t,e){t.exports=function(t,e,n){var o;if(!t)return 0;if(n=n||t,t instanceof Array){for(o=0;o<t.length;o++)if(!1===e.call(n,t[o],o,t))return 0}else for(o in t)if(t.hasOwnProperty(o)&&!1===e.call(n,t[o],o,t))return 0;return 1}},function(t,e,n){var o=n(53),r=(n(16),n(29),n(36));o.helpers=o.helpers||{},o.on("client",function(t){t.extensions={events:[],collections:{}},t.queue=r(),t.queue.on("flush",function(){t.recordDeferredEvents()})}),o.prototype.writeKey=function(t){return arguments.length?(this.config.writeKey=t?String(t):null,this):this.config.writeKey},o.prototype.setGlobalProperties=function(t){if(o.log("This method has been deprecated. Check out #extendEvents: https://github.com/keen/keen-tracking.js#extend-events"),t&&"function"==typeof t)return this.config.globalProperties=t,this;this.emit("error","Invalid value for global properties: "+t)},t.exports=o},function(t,e,n){(function(o){var r;(function(o){"use strict";var i=n(32),s=n(29);s(i.prototype,n(50)),s(i.prototype,n(46)),s(i.prototype,{extendEvent:n(28).extendEvent,extendEvents:n(28).extendEvents}),s(i.helpers,{getScreenProfile:n(45),getWindowProfile:n(44)}),void 0!==t&&t.exports&&(t.exports=i),void 0===(r=function(){return i}.apply(e,[]))||(t.exports=r)}).call(this,"undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:{})}).call(this,n(13))},function(t,e,n){"use strict";n.r(e),n.d(e,"AnnotoPolyfills",function(){return s});var o=n(38),r=n(12);Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};var i=window,s=function(){function t(t,e){this.logger=t,this.loader=e,this.browser=Object(o.detect)(),this.polyfilled=!1}return t.prototype.polyfill=function(t){var e=this;if(this.polyfilled)t();else{this.loader.loadStyle(r.a.robotoFontUrl,function(t){t&&e.logger.warn("Error Loading Robot Font: ",t)});var o=i.ANNOTO_HAS_PROMISE||!("ie"===this.browser.name)||"function"==typeof Promise||"object"==typeof Promise,s=!("object"!=typeof fetch&&"function"!=typeof fetch||"object"!=typeof Request&&"function"!=typeof Request),a=function(){o&&s&&(e.polyfilled=!0,t())};a(),o||("function"==typeof define&&n(39)&&(requirejs,1)?(this.logger.log("Polyfill bluebird using requirejs"),requirejs([r.a.bluebirdUrl],function(t){i.Promise=t,o=!0,a()})):(this.logger.log("Polyfill bluebird"),this.loader.loadScript(r.a.bluebirdUrl,function(){o=!0,a()}))),s||(this.logger.log("Polyfill fetch"),this.loader.loadScript(r.a.fetchUrl,function(){s=!0,a()}))}},t}()},function(t,e,n){"use strict";n.d(e,"a",function(){return o});var o=function(){function t(t){this._config=t}return t.prototype.load=function(t,e){return this._app.load(t,e)},t.prototype.close=function(t,e){return void 0===t&&(t=0),this._app.close(t,e)},t.prototype.auth=function(t,e){return this._app.auth(t,e)},t.prototype.logout=function(t){return this._app.logout(t)},t.prototype.registerDeviceDetector=function(t,e){return this._app.registerDeviceDetector(t,e)},t.prototype.registerOriginProvider=function(t,e){return this._app.registerOriginProvider(t,e)},t.prototype.show=function(t){return this._app.show(t)},t.prototype.hide=function(t){return this._app.hide(t)},t.prototype.getMetadata=function(){return this._app.getMetadata()},Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),t}()},function(t,e,n){function o(){return this instanceof o==!1?new o:(this.capacity=0,this.config={capacity:5e3,interval:15},this.events={},this.interval=0,this.timer=null,this)}n(37)(o.prototype),o.prototype.check=function(){return function(t){if(t.capacity>0&&t.interval>=t.config.interval)return!0;if(t.capacity>=t.config.capacity)return!0;return!1}(this)&&this.flush(),0!==this.config.interval&&0!==this.capacity||this.pause(),this},o.prototype.flush=function(){return this.emit("flush"),this.interval=0,this},o.prototype.pause=function(){return this.timer&&(clearInterval(this.timer),this.timer=null),this},o.prototype.start=function(){var t=this;return t.pause(),t.timer=setInterval(function(){t.interval++,t.check()},1e3),t},t.exports=o},function(t,e,n){function o(t){if(t)return function(t){for(var e in o.prototype)t[e]=o.prototype[e];return t}(t)}t.exports=o,o.prototype.on=o.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},o.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,o=this._callbacks["$"+t];if(!o)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var r=0;r<o.length;r++)if((n=o[r])===e||n.fn===e){o.splice(r,1);break}return this},o.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n)for(var o=0,r=(n=n.slice(0)).length;o<r;++o)n[o].apply(this,e);return this},o.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},o.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){(function(e){function o(t){var e=s([["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]]).filter(function(e){return e.rule&&e.rule.test(t)})[0];return e?e.name:null}function r(){return"undefined"==typeof navigator&&void 0!==e?{name:"node",version:e.version.slice(1),os:n(54).type().toLowerCase()}:null}function i(t){var e=s([["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/]]);if(!t)return null;var n=e.map(function(e){var n=e.rule.exec(t),o=n&&n[1].split(/[._]/).slice(0,3);return o&&o.length<3&&(o=o.concat(1==o.length?[0,0]:[0])),n&&{name:e.name,version:o.join(".")}}).filter(Boolean)[0]||null;return n&&(n.os=o(t)),n}function s(t){return t.map(function(t){return{name:t[0],rule:t[1]}})}t.exports={detect:function(){var t=r();return t||("undefined"!=typeof navigator?i(navigator.userAgent):null)},detectOS:o,getNodeVersion:r,parseUserAgent:i}}).call(this,n(17))},function(t,e){(function(e){t.exports=e}).call(this,{})},,,,function(t,e,n){"use strict";n.r(e);var o=function(){function t(t){this.name=t}return t.prototype.log=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];window.console&&(t=window.console).log.apply(t,[this.name+": "].concat(e))},t.prototype.warn=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];window.console&&(t=window.console).warn.apply(t,[this.name+": "].concat(e))},t.prototype.error=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];window.console&&(t=window.console).error.apply(t,[this.name+": "].concat(e))},t}(),r=n(12),i=function(){function t(t){this.logger=t,this.el={}}return t.prototype.publish=function(t,e){var n,o;if("string"!=typeof t)throw new Error("Event must be string");if(n=this.el[t]){o=(n=n.slice()).length;try{for(;o--;)n[o](e,t)}catch(t){this.logger.error("PubSub: "+t.toString())}}},t.prototype.subscribe=function(t,e){var n;if("string"!=typeof t)throw new Error("Event must be string");return(n=this.el[t]||(this.el[t]=[])).push(e),{dispose:function(){var t=n.indexOf(e);-1!==t&&n.splice(t,1)}}},t}(),s=function(){function t(){this.loaders={}}return t.prototype.loader=function(t){var e=this;return function(n,o){if(e.loaders[n])o(new Error("Asset already loadded"));else{var r=t(n);e.loaders[n]=o,"function"==typeof r.addEventListener?r.addEventListener("load",function(){return o()},{once:!0,passive:!0}):o(new Error("Not supported Browser"))}}},t.prototype.loadScript=function(t,e){this.loader(function(t){var e=document.createElement("script");e.src=t,document.body.appendChild(e);var n=document.getElementsByTagName("script")[0];return n?n.parentNode.insertBefore(e,n):document.body.appendChild(e),e})(t,e)},t.prototype.loadStyle=function(t,e){return this.loader(function(t){var e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t;var n=document.getElementsByTagName("link")[0];return n?n.parentNode.insertBefore(e,n):document.head.appendChild(e),e})(t,e)},t}(),a=n(33),c=n.n(a),u=function(){function t(t,e){this.options=t,this.logger=e}return t.prototype.sincePageLoad=function(){return performance.timing&&performance.timing.domComplete?Math.round(Date.now()-performance.timing.domComplete):Math.round(performance.now())},t.prototype.setup=function(){c.a.debug=this.options.env.ENV.KEEN.DEBUG,this.client=new c.a({projectId:this.options.env.ENV.KEEN.PROJECT_ID,writeKey:this.options.env.ENV.KEEN.KEY,protocol:"https",requestType:"xhr"})},t.prototype.recordBootstrap=function(){var t=this;this.client.recordEvent("app_interaction",{event_type:"bootstrap",page:{title:document.title,url:window.location.href},referrer:{url:document.referrer},ip_address:"${keen.ip}",user_agent:{raw:"${keen.user_agent}"},client_timestamp:(new Date).toISOString(),timing:{since_page_load:this.sincePageLoad()},keen:{addons:[{name:"keen:ip_to_geo",input:{ip:"ip_address"},output:"ip_geo_info"},{name:"keen:ua_parser",input:{ua_string:"user_agent.raw"},output:"user_agent"},{name:"keen:url_parser",input:{url:"page.url"},output:"page"},{name:"keen:referrer_parser",input:{page_url:"page.url",referrer_url:"referrer.url"},output:"referrer.info"},{name:"keen:date_time_parser",input:{date_time:"keen.timestamp"},output:"timestamp_info"},{name:"keen:date_time_parser",input:{date_time:"client_timestamp"},output:"client_timestamp_info"}]}},function(e){e&&t.logger.warn("Analytics: bootstrap: ",e)})},t}(),l=n(35),p=n(34);n.d(e,"AnnotoBootstrap",function(){return f});var d=window,f=function(){function t(){this.document=document,this.bootstrapping=!1,this.bootConfigCalled=!1,this.setupAppConfigOnBootstrap=!1,this.global=d,this.api=void 0,this.options=r.a,this.bootstraped=!1,this.developmentLogging=!1,this.logger=new o("AnnotoBootstrap"),this.pubSub=new i(this.logger),this.loader=new s,this.polyfills=new p.AnnotoPolyfills(this.logger,this.loader);var t=this.getDebug();this.developmentLogging=Boolean("logs"===t||this.options.env.ENV.DEBUG_LOGS),this.setupAnnotoGlob(),this.setupAnalytics()}return t.prototype.bootstrap=function(){var t=this;this.bootstraped||this.bootstrapping?this.logger.warn("Already bootstrapped/bootstrapping"):(this.bootstrapping=!0,this.setupAppContainer(),this.setupAppRoot(),this.setupDBAContainer(),this.polyfills.polyfill(function(e){return e&&t.logger.error("Polyfilling error: ",e),t.importApp().then(function(t){return t.bootApp()}).then(function(){if(t.bootstraped=!0,t.bootstrapping=!1,t.logger.log("bootstrap"),t.setupAppConfigOnBootstrap)return t.setupAppConfig()}).catch(function(e){t.logger.error("Bootstrapping:",e),t.bootstraped=!1,t.bootstrapping=!1})}))},t.prototype.analyticsClient=function(){return this.analytics.client},t.prototype.bootConfig=function(t){var e=this;if(this.bootConfigCalled)this.logger.error("already running, please use the API");else if(this.validConfig(t)){if(this.customerConfig=t,this.bootConfigCalled=!0,this.bootstraped)return this.setupAppConfig().catch(function(t){e.logger.error(t)});this.setupAppConfigOnBootstrap=!0}else this.logger.error("unable to bootConfig, invalid config object")},t.prototype.setupAppConfig=function(){return this.customerConfig?(this.logger.log("start"),this.updateAppContainer(),this.api=new l.a(this.customerConfig),this.api.pubSub=this.pubSub,Promise.resolve()):Promise.reject(new Error("Unable to load Annoto API, customer Configuration is missing"))},t.prototype.importApp=function(){var t=this;return Promise.all([n.e(0),n.e(1),n.e(2)]).then(n.bind(null,360)).then(function(e){return new e.AnnotoAppBootstrap(t)})},t.prototype.validConfig=function(t){return Boolean(t&&"object"==typeof t)},t.prototype.updateAppContainer=function(){var t=this.document.getElementById(this.options.appContainerID);t&&this.appEl&&(this.appContainerEl.id===this.options.defaultAppContainerID||t!==this.appContainerEl)&&(this.logger.log("moving annoto app to host container"),t.appendChild(this.appEl),this.appContainerEl=t,this.appContainerElParent=this.appContainerEl.parentElement)},t.prototype.setupAppRoot=function(){this.appEl=this.document.getElementById(this.options.appID),this.appEl?this.logger.warn("app root is already setup"):(this.appEl=this.document.createElement("DIV"),this.appEl.id=this.options.appID,this.appContainerEl.appendChild(this.appEl))},t.prototype.setupAppContainer=function(){if(this.appContainerEl=this.document.getElementById(this.options.appContainerID),!(this.appContainerEl&&this.appContainerEl instanceof Element)){this.logger.log("application container not specified, using default");var t=this.document.createElement("DIV");t.id=this.options.defaultAppContainerID,this.document.body.appendChild(t),this.appContainerEl=t}this.appContainerElParent=this.appContainerEl.parentElement},t.prototype.setupDBAContainer=function(){this.dbaAppEl=this.document.getElementById(this.options.dbaID),this.dbaAppEl||(this.dbaAppEl=this.document.createElement("IFRAME"),this.dbaAppEl.src=this.options.env.ENV.DBA_URL+"?parent_url="+encodeURIComponent(location.href)+"&title="+encodeURIComponent(this.document.title)+"&referrer="+encodeURIComponent(this.document.referrer)+"&app_name="+encodeURIComponent("annoto_widget"),this.dbaAppEl.style.display="none",this.dbaAppEl.id=this.options.dbaID,this.document.body.appendChild(this.dbaAppEl))},t.prototype.setupAnalytics=function(){this.analytics=new u(this.options,this.logger),this.analytics.setup()},t.prototype.setupAnnotoGlob=function(){var t=this,e={on:this.pubSub.subscribe.bind(this.pubSub),boot:function(e){return t.bootConfig(e)}};this.global.Annoto=this.global.Annoto||e},t.prototype.getDebug=function(){var t;try{t=sessionStorage.getItem("annoto_debug")}catch(t){}return t},t}()},function(t,e){t.exports=function(){var t,e,n;return"undefined"==typeof document?{}:(t=document.body,e=document.documentElement,n={height:"innerHeight"in window?window.innerHeight:document.documentElement.offsetHeight,width:"innerWidth"in window?window.innerWidth:document.documentElement.offsetWidth,scrollHeight:Math.max(t.scrollHeight,t.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight)||null},window.screen&&(n.ratio={height:window.screen.availHeight?parseFloat((window.innerHeight/window.screen.availHeight).toFixed(2)):null,width:window.screen.availWidth?parseFloat((window.innerWidth/window.screen.availWidth).toFixed(2)):null}),n)}},function(t,e){t.exports=function(){var t,e;if("undefined"==typeof window||!window.screen)return{};t=["height","width","colorDepth","pixelDepth","availHeight","availWidth"],e={};for(var n=0;n<t.length;n++)e[t[n]]=window.screen[t[n]]?window.screen[t[n]]:null;return e.orientation={angle:window.screen.orientation?window.screen.orientation.angle:0,type:window.innerWidth>window.innerHeight?"landscape":"portrait"},e}},function(t,e,n){n(32);var o=n(16),r=n(36);function i(t){var e="Event(s) not deferred: "+t;this.emit("error",e)}t.exports={deferEvent:function(t,e){if(2!==arguments.length||"string"!=typeof t)return void i.call(this,"Incorrect arguments provided to #deferEvent method");this.queue.events[t]=this.queue.events[t]||[],this.queue.events[t].push(e),this.queue.capacity++,this.queue.timer||this.queue.start();return this.emit("deferEvent",t,e),this},deferEvents:function(t){var e=this;if(1!==arguments.length||"object"!=typeof t)return void i.call(this,"Incorrect arguments provided to #deferEvents method");return o(t,function(t,n){e.queue.events[n]=e.queue.events[n]||[],e.queue.events[n]=e.queue.events[n].concat(t),e.queue.capacity=e.queue.capacity+t.length,e.queue.timer||e.queue.start()}),e.emit("deferEvents",t),e},queueCapacity:function(t){return arguments.length?(this.queue.config.capacity=t?Number(t):0,this.queue.check(),this):this.queue.config.capacity},queueInterval:function(t){return arguments.length?(this.queue.config.interval=t?Number(t):0,this.queue.check(),this):this.queue.config.interval},recordDeferredEvents:function(){var t,e,n=this;n.queue.capacity>0&&(n.queue.pause(),t=JSON.parse(JSON.stringify(n.queue.config)),e=JSON.parse(JSON.stringify(n.queue.events)),n.queue=r(),n.queue.config=t,n.emit("recordDeferredEvents",e),n.recordEvents(e,function(t,o){t?n.recordEvents(e):e=void 0}));return n}}},function(t,e){function n(t){return JSON.parse(JSON.stringify(t))}t.exports=function t(e){for(var o=1;o<arguments.length;o++)if(e instanceof Array&&arguments[o]instanceof Array)for(var r=0;r<arguments[o].length;r++)e.indexOf(arguments[o][r])<0&&e.push(arguments[o][r]);else for(var i in arguments[o])void 0!==e[i]&&"object"==typeof arguments[o][i]&&null!==arguments[o][i]?t(e[i],n(arguments[o][i])):void 0!==arguments[o][i]&&(e[i]=n(arguments[o][i]));return e}},function(t,e){t.exports={map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){"use strict";var e,n,o,r,i,s,a,c="",u=0,l=this.map;for(t=this.utf8.encode(t);u<t.length;)e=t.charCodeAt(u++),n=t.charCodeAt(u++),o=t.charCodeAt(u++),r=e>>2,i=(3&e)<<4|n>>4,s=isNaN(n)?64:(15&n)<<2|o>>6,a=isNaN(n)||isNaN(o)?64:63&o,c=c+l.charAt(r)+l.charAt(i)+l.charAt(s)+l.charAt(a);return c},decode:function(t){"use strict";var e,n,o,r,i,s,a="",c=0,u=this.map,l=String.fromCharCode;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=u.indexOf(t.charAt(c++)),i=(15&(n=u.indexOf(t.charAt(c++))))<<4|(o=u.indexOf(t.charAt(c++)))>>2,s=(3&o)<<6|(r=u.indexOf(t.charAt(c++))),a=a+(l(e<<2|n>>4)+(64!=o?l(i):""))+(64!=r?l(s):"");return this.utf8.decode(a)},utf8:{encode:function(t){"use strict";for(var e,n="",o=0,r=String.fromCharCode;o<t.length;)n+=(e=t.charCodeAt(o++))<128?r(e):e>127&&e<2048?r(e>>6|192)+r(63&e|128):r(e>>12|224)+r(e>>6&63|128)+r(63&e|128);return n},decode:function(t){"use strict";for(var e,n="",o=0,r=String.fromCharCode;o<t.length;)n+=(e=t.charCodeAt(o))<128?[r(e),o++][0]:e>191&&e<224?[r((31&e)<<6|63&t.charCodeAt(o+1)),o+=2][0]:[r((15&e)<<12|(63&t.charCodeAt(o+1))<<6|63&(c3=t.charCodeAt(o+2))),o+=3][0];return n}}}},function(t,e,n){t.exports=n(48)},function(t,e,n){var o=n(32),r=n(49),i=n(16),s=n(29),a=n(28);function c(t,e,n,i){var c,u,g,m,v,y,b;if(c=this.url("events",encodeURIComponent(t)),u={},g=n,b="boolean"!=typeof i||i,l.call(this,g)){if(t&&"string"==typeof t){if(this.config.globalProperties&&(u=this.config.globalProperties(t)),s(u,e),y={},a.getExtendedEventBody(y,this.extensions.events),a.getExtendedEventBody(y,this.extensions.collections[t]),a.getExtendedEventBody(y,[u]),this.emit("recordEvent",t,y),!o.enabled)return p.call(this,"Keen.enabled is set to false.",g),!1;if(v=(m=this.url("events",encodeURIComponent(t),{api_key:this.writeKey(),data:encodeURIComponent(r.encode(JSON.stringify(y))),modified:(new Date).getTime()})).length<function(){if("undefined"!=typeof window&&navigator&&(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0))return 2e3;return 16e3}(),b)switch(this.config.requestType){case"xhr":f.call(this,"POST",c,y,g);break;case"beacon":v?function(t,e){var n=this,o=e,r=document.createElement("img");e=null,r.onload=function(){if(!0,"naturalHeight"in this){if(this.naturalHeight+this.naturalWidth===0)return void this.onerror()}else if(this.width+this.height===0)return void this.onerror();o&&o.call(n)},r.onerror=function(){!0,o&&o.call(n,"An error occurred!",null)},r.src=t+"&c=clv1"}.call(this,m,g):d.call(this,c,y,"Beacon URL length exceeds current browser limit, and XHR is not supported.",g);break;default:v?function(t,e){var n=this,o=e,r=(new Date).getTime(),i=document.createElement("script"),s=document.getElementsByTagName("head")[0],a="keenJSONPCallback",c=!1;e=null,a+=r;for(;a in window;)a+="a";function u(){o&&o.call(n,"An error occurred!",null)}function l(){window[a]=void 0;try{delete window[a]}catch(t){}s.removeChild(i)}window[a]=function(t){!0!==c&&(c=!0,o&&o.call(n,null,t),l())},i.src=t+"&jsonp="+a,s.appendChild(i),i.onreadystatechange=function(){!1===c&&"loaded"===this.readyState&&(c=!0,u(),l())},i.onerror=function(){!1===c&&(c=!0,u(),l())}}.call(this,m,g):d.call(this,c,y,"JSONp URL length exceeds current browser limit, and XHR is not supported.",g)}else v&&function(t){var e=h();e&&(e.open("GET",t,!1),e.send(null))}(m);return n=g=null,this}p.call(this,"Collection name must be a string.",g)}}function u(t,e){var n,r,c,u=this;if(n=this.url("events"),r=e,e=null,l.call(this,r))if("object"!=typeof t||t instanceof Array)p.call(this,"First argument must be an object",r);else{if(!(arguments.length>2))return this.config.globalProperties&&i(t,function(e,n){i(e,function(e,o){var r=u.config.globalProperties(n);t[n][o]=s(r,e)})}),c={},i(t,function(t,e){c[e]=c[e]||[],i(t,function(t,n){var o={};a.getExtendedEventBody(o,u.extensions.events),a.getExtendedEventBody(o,u.extensions.collections[e]),a.getExtendedEventBody(o,[t]),c[e].push(o)})}),this.emit("recordEvents",c),o.enabled?(h()&&f.call(this,"POST",n,c,r),e=r=null,this):(p.call(this,"Keen.enabled is set to false.",r),!1);p.call(this,"Incorrect arguments provided to #recordEvents method",r)}}function l(t){var e=t;return t=null,this.projectId()?!!this.writeKey()||(p.call(this,"Keen.Client is missing a writeKey property.",e),!1):(p.call(this,"Keen.Client is missing a projectId property.",e),!1)}function p(t,e){var n="Event(s) not recorded: "+t;this.emit("error",n),e&&(e.call(this,n,null),e=null)}function d(t,e,n,o){h()?f.call(this,"POST",t,e,o):p.call(this,n)}function f(t,e,n,r){var i,s=this,a=h(),c=r;r=null,a.onreadystatechange=function(){var t;if(4==a.readyState)if(a.status>=200&&a.status<300){try{t=JSON.parse(a.responseText)}catch(t){o.emit("error","Could not parse HTTP response: "+a.responseText),c&&c.call(s,a,null)}c&&t&&c.call(s,null,t)}else o.emit("error","HTTP request failed."),c&&c.call(s,a,null)},a.open(t,e,!0),a.setRequestHeader("Authorization",s.writeKey()),a.setRequestHeader("Content-Type","application/json"),n&&(i=JSON.stringify(n)),"GET"===t.toUpperCase()&&a.send(),"POST"===t.toUpperCase()&&a.send(i)}function h(){var t="undefined"==typeof window?this:window;if(t.XMLHttpRequest&&("file:"!=t.location.protocol||!t.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}return!1}t.exports={recordEvent:c,recordEvents:u,addEvent:function(){this.emit("error","This method has been deprecated. Check out #recordEvent: https://github.com/keen/keen-tracking.js#record-a-single-event"),c.apply(this,arguments)},addEvents:function(){this.emit("error","This method has been deprecated. Check out #recordEvents: https://github.com/keen/keen-tracking.js#record-multiple-events"),u.apply(this,arguments)}}},function(t,e,n){var o=n(31);n(30);t.exports=function(t){var e=[];return o(t,function(t,n){"string"!=typeof t&&(t=JSON.stringify(t)),e.push(n+"="+encodeURIComponent(t))}),e.join("&")}},function(t,e){t.exports=function(t){var e,n={},o=/\+/g,r=/([^&=]+)=?([^&]*)/g,i=function(t){return decodeURIComponent(t.replace(o," "))},s=t.split("?")[1];for(;e=r.exec(s);)n[i(e[1])]=i(e[2]);return n}},function(t,e,n){(function(e){(function(e){var o=e.Keen||void 0,r=n(31),i=n(30),s=n(52),a=n(51),c=n(37);function u(t){if(this instanceof u==!1)return new u(t);this.configure(t),u.debug&&this.on("error",u.log),this.emit("ready"),u.emit("client",this)}function l(t){return void 0!==t}o&&void 0===o.resources&&(u.legacyVersion=o),c(u),c(u.prototype),i(u,{debug:!1,enabled:!0,loaded:!1,version:"__VERSION__"}),u.helpers=u.helpers||{},u.resources=u.resources||{},i(u.resources,{base:"{protocol}://{host}",version:"{protocol}://{host}/3.0",projects:"{protocol}://{host}/3.0/projects",projectId:"{protocol}://{host}/3.0/projects/{projectId}",events:"{protocol}://{host}/3.0/projects/{projectId}/events",queries:"{protocol}://{host}/3.0/projects/{projectId}/queries"}),u.utils=u.utils||{},i(u.utils,{each:r,extend:i,parseParams:s,serialize:a}),u.extendLibrary=function(t,e){var n=o||e;return l(n)&&l(n.resources)&&(r(n,function(e,n){"object"==typeof e?(t[n]=t[n]||{},i(t[n],e)):t[n]=t[n]||e}),i(t.prototype,n.prototype)),t},u.log=function(t){u.debug&&"object"==typeof console&&console.log("[Keen]",t)},u.noConflict=function(){return void 0!==e.Keen&&(e.Keen=u.legacyVersion||o),u},u.ready=function(t){u.loaded?t():u.once("ready",t)},u.prototype.configure=function(t){var e=t||{};return this.config=this.config||{projectId:void 0,writeKey:void 0,host:"api.keen.io",protocol:"https",requestType:"jsonp",resources:i({},u.resources)},"undefined"!=typeof window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1&&(e.protocol=document.location.protocol.replace(":","")),e.host&&e.host.replace(/.*?:\/\//g,""),i(this.config,e),this},u.prototype.masterKey=function(t){return arguments.length?(this.config.masterKey=t?String(t):null,this):this.config.masterKey},u.prototype.projectId=function(t){return arguments.length?(this.config.projectId=t?String(t):null,this):this.config.projectId},u.prototype.resources=function(t){if(!arguments.length)return this.config.resources;var e=this;return"object"==typeof t&&r(t,function(t,n){e.config.resources[n]=t||null}),e},u.prototype.url=function(t){var e,n=Array.prototype.slice.call(arguments,1),o=this.config.resources.base||"{protocol}://{host}";return e=t&&"string"==typeof t?this.config.resources[t]?this.config.resources[t]:o+t:o,r(this.config,function(t,n){"object"!=typeof t&&(e=e.replace("{"+n+"}",t))}),r(n,function(t,n){"string"==typeof t?e+="/"+t:"object"==typeof t&&(e+="?",r(t,function(t,n){e+=n+"="+t+"&"}),e=e.slice(0,-1))}),e},function(t){if(u.loaded||"undefined"==typeof document)return void t();null==document.readyState&&document.addEventListener&&(document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t,!1),document.readyState="complete"},!1),document.readyState="loading");!function t(e){/in/.test(document.readyState)?setTimeout(function(){t(e)},9):e()}(t)}(function(){u.loaded=!0,u.emit("ready")}),t.exports=u}).call(this,"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{})}).call(this,n(13))},function(t,e){e.endianness=function(){return"LE"},e.hostname=function(){return"undefined"!=typeof location?location.hostname:""},e.loadavg=function(){return[]},e.uptime=function(){return 0},e.freemem=function(){return Number.MAX_VALUE},e.totalmem=function(){return Number.MAX_VALUE},e.cpus=function(){return[]},e.type=function(){return"Browser"},e.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},e.networkInterfaces=e.getNetworkInterfaces=function(){return{}},e.arch=function(){return"javascript"},e.platform=function(){return"browser"},e.tmpdir=e.tmpDir=function(){return"/tmp"},e.EOL="\n",e.homedir=function(){return"/"}},function(t,e,n){n(34);var o=new(n(43).AnnotoBootstrap);t.exports=o.global.Annoto,-1!==["interactive","complete"].indexOf(document.readyState)?o.bootstrap():document.addEventListener("DOMContentLoaded",function(){o.bootstrap()})},function(t,e,n){t.exports=n(55)}])});
